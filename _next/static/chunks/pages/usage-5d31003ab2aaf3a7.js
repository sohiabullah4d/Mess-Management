(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[317],{712:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>I});var l=n(5640),a=n(148),r=n(3097),i=n(6624),s=n(5057),d=n(4447),o=n(9246),u=n(2714),c=n(7498),m=n(6393),h=n(3857),p=n(90),x=n(5482),j=n(6105),g=n(8894),A=n(331),v=n(1957);let b=v.Ik({mealId:v.Yj().required("Meal is required"),date:v.Yj().required("Date is required"),peopleCount:v.ai().min(1,"Must serve at least 1 person").required("People count is required")});var f=n(5906);let y=e=>{let{onSubmit:t}=e,{state:n}=(0,f.U)(),a=(0,A.Wx)({initialValues:{mealId:"",date:new Date().toISOString().split("T")[0],peopleCount:1},validationSchema:b,onSubmit:e=>{t(e)}}),s=n.meals.find(e=>e.id===a.values.mealId);return(0,l.jsx)("form",{id:"usage-form",onSubmit:a.handleSubmit,children:(0,l.jsxs)(d.Ay,{container:!0,spacing:2,children:[(0,l.jsx)(d.Ay,{item:!0,xs:12,children:(0,l.jsxs)(o.A,{fullWidth:!0,children:[(0,l.jsx)(u.A,{children:"Select Meal"}),(0,l.jsx)(c.A,{id:"mealId",name:"mealId",value:a.values.mealId,onChange:a.handleChange,error:a.touched.mealId&&!!a.errors.mealId,label:"Select Meal",children:n.meals.map(e=>(0,l.jsx)(m.A,{value:e.id,children:e.name},e.id))})]})}),(0,l.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,l.jsx)(h.A,{fullWidth:!0,id:"date",name:"date",label:"Date",type:"date",value:a.values.date,onChange:a.handleChange,error:a.touched.date&&!!a.errors.date,helperText:a.touched.date&&a.errors.date,InputLabelProps:{shrink:!0}})}),(0,l.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,l.jsx)(h.A,{fullWidth:!0,id:"peopleCount",name:"peopleCount",label:"Number of People",type:"number",value:a.values.peopleCount,onChange:a.handleChange,error:a.touched.peopleCount&&!!a.errors.peopleCount,helperText:a.touched.peopleCount&&a.errors.peopleCount,inputProps:{min:1}})}),s&&(0,l.jsxs)(d.Ay,{item:!0,xs:12,children:[(0,l.jsx)(i.A,{variant:"h6",gutterBottom:!0,children:"Required Items"}),(0,l.jsx)(r.A,{sx:{p:2,bgcolor:"grey.100",borderRadius:1},children:s.items.map((e,t)=>{let s=n.items.find(t=>t.id===e.itemId),d=e.usagePerPerson*a.values.peopleCount,o=s&&s.quantity>=d;return(0,l.jsxs)(r.A,{sx:{mb:1},children:[(0,l.jsxs)(i.A,{variant:"body2",children:[null==s?void 0:s.name,": ",e.usagePerPerson," ",null==s?void 0:s.unit," ","per person \xd7 ",a.values.peopleCount," people ="," ",d," ",null==s?void 0:s.unit]}),!o&&(0,l.jsxs)(p.A,{severity:"error",sx:{mt:1},children:["Insufficient stock! Only ",null==s?void 0:s.quantity," ",null==s?void 0:s.unit," available."]})]},t)})})]})]})})};var C=n(1767);let I=()=>{let{state:e,addMealUsage:t}=(0,f.U)(),[n,A]=(0,a.useState)(!1),[v,b]=(0,a.useState)(null),[I,S]=(0,a.useState)({mealId:"",date:""}),[P,w]=(0,a.useState)(0),[U,k]=(0,a.useState)(10),[q,R]=(0,a.useState)("date"),[D,M]=(0,a.useState)("desc"),_=e.usage.filter(e=>(!I.mealId||e.mealId===I.mealId)&&(!I.date||e.date===I.date)),E=_.sort((e,t)=>"asc"===D?e[q]>t[q]?1:-1:e[q]<t[q]?1:-1).slice(P*U,P*U+U),O=[{id:"date",label:"Date",sortable:!0,format:e=>(0,C.Yq)(String(e))},{id:"mealId",label:"Meal",sortable:!0,format:(t,n)=>{let l="string"==typeof t?t:"number"==typeof t?String(t):null==n?void 0:n.mealId,a=e.meals.find(e=>e.id===l);return(null==a?void 0:a.name)||"Unknown"}},{id:"peopleCount",label:"People Served",sortable:!0,align:"right"},{id:"itemsUsed",label:"Items Used",sortable:!1,format:(t,n)=>{let a=Array.isArray(t)?t:(null==n?void 0:n.itemsUsed)&&Array.isArray(n.itemsUsed)?n.itemsUsed:[];return a.length?(0,l.jsx)(r.A,{children:a.map((t,n)=>{let a=e.items.find(e=>e.id===t.itemId);return(0,l.jsxs)(r.A,{sx:{fontSize:"0.875rem"},children:[null==a?void 0:a.name,": ",t.totalUsed," ",null==a?void 0:a.unit]},n)})}):null}}];return(0,l.jsxs)(r.A,{children:[(0,l.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,l.jsx)(i.A,{variant:"h4",children:"Meal Usage Tracking"}),(0,l.jsxs)(r.A,{children:[(0,l.jsx)(s.A,{variant:"outlined",onClick:()=>{let t=e.usage.map(t=>{let n=e.meals.find(e=>e.id===t.mealId);return{Date:(0,C.Yq)(t.date),Meal:(null==n?void 0:n.name)||"Unknown","People Served":t.peopleCount,"Items Used":t.itemsUsed.map(t=>{let n=e.items.find(e=>e.id===t.itemId);return"".concat(null==n?void 0:n.name," (").concat(t.totalUsed," ").concat(null==n?void 0:n.unit,")")}).join(", ")}});(0,C.GF)(t,"usage-export")},sx:{mr:2},children:"Export CSV"}),(0,l.jsx)(s.A,{variant:"contained",startIcon:(0,l.jsx)(x.A,{}),onClick:()=>A(!0),children:"Record Meal Usage"})]})]}),(0,l.jsx)(r.A,{sx:{mb:3,p:2,bgcolor:"background.paper",borderRadius:1},children:(0,l.jsxs)(d.Ay,{container:!0,spacing:2,children:[(0,l.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,l.jsxs)(o.A,{fullWidth:!0,children:[(0,l.jsx)(u.A,{children:"Filter by Meal"}),(0,l.jsxs)(c.A,{value:I.mealId,label:"Filter by Meal",onChange:e=>S({...I,mealId:e.target.value}),children:[(0,l.jsx)(m.A,{value:"",children:"All Meals"}),e.meals.map(e=>(0,l.jsx)(m.A,{value:e.id,children:e.name},e.id))]})]})}),(0,l.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,l.jsx)(h.A,{fullWidth:!0,label:"Filter by Date",type:"date",value:I.date,onChange:e=>S({...I,date:e.target.value}),InputLabelProps:{shrink:!0}})})]})}),v&&(0,l.jsx)(p.A,{severity:"error",sx:{mb:2},children:v}),(0,l.jsx)(g.X,{columns:O,data:E,page:P,rowsPerPage:U,totalRows:_.length,onPageChange:w,onRowsPerPageChange:k,orderBy:q,order:D,onSort:e=>{M(q===e&&"asc"===D?"desc":"asc"),R(e)}}),(0,l.jsx)(j.a,{open:n,onClose:()=>{A(!1),b(null)},title:"Record Meal Usage",actions:(0,l.jsxs)(r.A,{children:[(0,l.jsx)(s.A,{onClick:()=>A(!1),children:"Cancel"}),(0,l.jsx)(s.A,{type:"submit",form:"usage-form",variant:"contained",children:"Record Usage"})]}),children:(0,l.jsx)(y,{onSubmit:e=>{try{t(e),A(!1),b(null)}catch(e){e instanceof Error?b(e.message):b(String(e))}},onCancel:()=>A(!1)})})]})}},1767:(e,t,n)=>{"use strict";n.d(t,{GF:()=>i,J8:()=>a,P2:()=>r,Yq:()=>l});let l=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),a=(e,t)=>e.filter(e=>(!t.name||!!e.name.toLowerCase().includes(t.name.toLowerCase()))&&(!t.status||e.status===t.status)&&(!t.unit||e.unit===t.unit)),r=(e,t,n,l,a)=>{let r=new Date(l,a-1,1),i=new Date(l,a,0),s=e.filter(e=>{let t=new Date(e.date);return t>=r&&t<=i}),d=s.length,o={};s.forEach(e=>{e.itemsUsed.forEach(e=>{o[e.itemId]||(o[e.itemId]=0),o[e.itemId]+=e.totalUsed})});let u=t.map(e=>{let t=o[e.id]||0,n=e.quantity-t;return{...e,used:t,remaining:n,needsRestocking:n<.2*e.quantity}}).filter(e=>e.needsRestocking),c=Object.entries(o).map(e=>{let[n,l]=e,a=t.find(e=>e.id===n);return{name:(null==a?void 0:a.name)||"Unknown",totalUsed:l,unit:(null==a?void 0:a.unit)||""}}).sort((e,t)=>t.totalUsed-e.totalUsed).slice(0,5);return{mealsPrepared:d,itemUsage:o,itemsNeedRestocking:u,mostUsedItems:c}},i=(e,t)=>{let n=Object.keys(e[0]||{}).join(","),l=e.map(e=>Object.values(e).map(e=>"string"==typeof e&&e.includes(",")?'"'.concat(e,'"'):e).join(",")).join("\n"),a=new Blob(["".concat(n,"\n").concat(l)],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),i=URL.createObjectURL(a);r.setAttribute("href",i),r.setAttribute("download","".concat(t,".csv")),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}},4704:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/usage",function(){return n(712)}])},6105:(e,t,n)=>{"use strict";n.d(t,{a:()=>u});var l=n(5640);n(148);var a=n(5704),r=n(2375),i=n(2738),s=n(7021),d=n(2711),o=n(7630);let u=e=>{let{open:t,onClose:n,title:u,children:c,actions:m}=e;return(0,l.jsxs)(a.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,l.jsxs)(r.A,{children:[u,(0,l.jsx)(i.A,{"aria-label":"close",onClick:n,sx:{position:"absolute",right:8,top:8},children:(0,l.jsx)(o.A,{})})]}),(0,l.jsx)(s.A,{children:c}),m&&(0,l.jsx)(d.A,{children:m})]})}},8894:(e,t,n)=>{"use strict";n.d(t,{X:()=>h});var l=n(5640);n(148);var a=n(1585),r=n(2254),i=n(9015),s=n(9366),d=n(8488),o=n(3245),u=n(3671),c=n(8932),m=n(5504);let h=e=>{let{columns:t,data:n,page:h,rowsPerPage:p,totalRows:x,onPageChange:j,onRowsPerPageChange:g,orderBy:A,order:v,onSort:b}=e;return(0,l.jsxs)(a.A,{children:[(0,l.jsx)(r.A,{children:(0,l.jsxs)(i.A,{children:[(0,l.jsx)(s.A,{children:(0,l.jsx)(d.A,{children:t.map(e=>{let t;return(0,l.jsx)(o.A,{align:e.align||"left",sortDirection:A===e.id&&v,children:e.sortable&&b?(0,l.jsx)(u.A,{active:A===e.id,direction:A===e.id?v:"asc",onClick:(t=String(e.id),()=>{null==b||b(t)}),children:e.label}):e.label},String(e.id))})})}),(0,l.jsx)(c.A,{children:n.map((e,n)=>(0,l.jsx)(d.A,{children:t.map(t=>{let n=e[t.id];return(0,l.jsx)(o.A,{align:t.align||"left",children:t.format?t.format(n,e):String(null!=n?n:"")},String(t.id))})},n))})]})}),(0,l.jsx)(m.A,{rowsPerPageOptions:[5,10,25],component:"div",count:x,rowsPerPage:p,page:h,onPageChange:(e,t)=>{j(t)},onRowsPerPageChange:e=>{g(parseInt(e.target.value,10))}})]})}}},e=>{e.O(0,[447,269,130,90,636,593,792],()=>e(e.s=4704)),_N_E=e.O()}]);
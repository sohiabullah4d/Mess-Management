(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[368],{1767:(e,t,n)=>{"use strict";n.d(t,{GF:()=>l,J8:()=>i,P2:()=>a,Yq:()=>s});let s=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),i=(e,t)=>e.filter(e=>(!t.name||!!e.name.toLowerCase().includes(t.name.toLowerCase()))&&(!t.status||e.status===t.status)&&(!t.unit||e.unit===t.unit)),a=(e,t,n,s,i)=>{let a=new Date(s,i-1,1),l=new Date(s,i,0),r=e.filter(e=>{let t=new Date(e.date);return t>=a&&t<=l}),o=r.length,d={};r.forEach(e=>{e.itemsUsed.forEach(e=>{d[e.itemId]||(d[e.itemId]=0),d[e.itemId]+=e.totalUsed})});let c=t.map(e=>{let t=d[e.id]||0,n=e.quantity-t;return{...e,used:t,remaining:n,needsRestocking:n<.2*e.quantity}}).filter(e=>e.needsRestocking),m=Object.entries(d).map(e=>{let[n,s]=e,i=t.find(e=>e.id===n);return{name:(null==i?void 0:i.name)||"Unknown",totalUsed:s,unit:(null==i?void 0:i.unit)||""}}).sort((e,t)=>t.totalUsed-e.totalUsed).slice(0,5);return{mealsPrepared:o,itemUsage:d,itemsNeedRestocking:c,mostUsedItems:m}},l=(e,t)=>{let n=Object.keys(e[0]||{}).join(","),s=e.map(e=>Object.values(e).map(e=>"string"==typeof e&&e.includes(",")?'"'.concat(e,'"'):e).join(",")).join("\n"),i=new Blob(["".concat(n,"\n").concat(s)],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),l=URL.createObjectURL(i);a.setAttribute("href",l),a.setAttribute("download","".concat(t,".csv")),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}},2176:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/meals",function(){return n(6986)}])},6105:(e,t,n)=>{"use strict";n.d(t,{a:()=>c});var s=n(5640);n(148);var i=n(5704),a=n(2375),l=n(2738),r=n(7021),o=n(2711),d=n(7630);let c=e=>{let{open:t,onClose:n,title:c,children:m,actions:u}=e;return(0,s.jsxs)(i.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,s.jsxs)(a.A,{children:[c,(0,s.jsx)(l.A,{"aria-label":"close",onClick:n,sx:{position:"absolute",right:8,top:8},children:(0,s.jsx)(d.A,{})})]}),(0,s.jsx)(r.A,{children:m}),u&&(0,s.jsx)(o.A,{children:u})]})}},6986:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>U});var s=n(5640),i=n(223),a=n(904),l=n(5482),r=n(4327),o=n(3097),d=n(8795),c=n(2738),m=n(4019),u=n(6624),h=n(5057),x=n(3857),j=n(148),A=n(4447),g=n(9246),p=n(2714),v=n(7498),b=n(6393),f=n(331),P=n(1957);let w=P.Ik({name:P.Yj().required("Meal name is required"),items:P.YO().of(P.Ik({itemId:P.Yj().required("Item is required"),usagePerPerson:P.ai().min(.01,"Usage must be at least 0.01").required("Usage is required")})).min(1,"At least one item is required")});var C=n(5906);let I=e=>{let{meal:t,onSubmit:n}=e,{state:i}=(0,C.U)(),r=(0,f.Wx)({initialValues:{name:(null==t?void 0:t.name)||"",items:(null==t?void 0:t.items)||[]},validationSchema:w,onSubmit:e=>{n(e)}}),[d,m]=(0,j.useState)({itemId:"",usagePerPerson:0}),h=i.items.filter(e=>!r.values.items.some(t=>t.itemId===e.id));return(0,s.jsx)("form",{id:"meal-form",onSubmit:r.handleSubmit,children:(0,s.jsxs)(A.Ay,{container:!0,spacing:2,children:[(0,s.jsx)(A.Ay,{item:!0,xs:12,children:(0,s.jsx)(x.A,{fullWidth:!0,id:"name",name:"name",label:"Meal Name",value:r.values.name,onChange:r.handleChange,error:r.touched.name&&!!r.errors.name,helperText:r.touched.name&&r.errors.name})}),(0,s.jsxs)(A.Ay,{item:!0,xs:12,children:[(0,s.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:"Items Required"}),(0,s.jsxs)(o.A,{sx:{display:"flex",gap:2,alignItems:"flex-end",mb:2},children:[(0,s.jsxs)(g.A,{sx:{minWidth:200},children:[(0,s.jsx)(p.A,{children:"Select Item"}),(0,s.jsx)(v.A,{value:d.itemId,label:"Select Item",onChange:e=>m({...d,itemId:e.target.value}),children:h.map(e=>(0,s.jsxs)(b.A,{value:e.id,children:[e.name," (",e.unit,")"]},e.id))})]}),(0,s.jsx)(x.A,{label:"Usage per person",type:"number",value:d.usagePerPerson,onChange:e=>m({...d,usagePerPerson:parseFloat(e.target.value)||0}),inputProps:{min:.01,step:.01},sx:{width:150}}),(0,s.jsx)(c.A,{onClick:()=>{d.itemId&&d.usagePerPerson>0&&(r.setFieldValue("items",[...r.values.items,{...d}]),m({itemId:"",usagePerPerson:0}))},color:"primary",disabled:!d.itemId||d.usagePerPerson<=0,children:(0,s.jsx)(l.A,{})})]}),r.values.items.map((e,t)=>{let n=i.items.find(t=>t.id===e.itemId);return(0,s.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[(0,s.jsx)(x.A,{value:(null==n?void 0:n.name)||"Unknown Item",disabled:!0,sx:{flexGrow:1}}),(0,s.jsx)(x.A,{value:"".concat(e.usagePerPerson," ").concat((null==n?void 0:n.unit)||""," per person"),disabled:!0,sx:{width:200}}),(0,s.jsx)(c.A,{onClick:()=>(e=>{let t=[...r.values.items];t.splice(e,1),r.setFieldValue("items",t)})(t),color:"error",children:(0,s.jsx)(a.A,{})})]},t)}),r.touched.items&&r.errors.items&&(0,s.jsx)(u.A,{color:"error",variant:"body2",sx:{mt:1},children:r.errors.items})]})]})})};var y=n(6105),S=n(8894),k=n(1767);let U=()=>{let{state:e,addMeal:t,updateMeal:n,deleteMeal:A}=(0,C.U)(),[g,p]=(0,j.useState)(!1),[v,b]=(0,j.useState)(),[f,P]=(0,j.useState)(""),[w,U]=(0,j.useState)(0),[q,_]=(0,j.useState)(10),[N,R]=(0,j.useState)("name"),[E,M]=(0,j.useState)("asc"),O=e.meals.filter(e=>e.name.toLowerCase().includes(f.toLowerCase())),L=O.sort((e,t)=>"asc"===E?e[N]>t[N]?1:-1:e[N]<t[N]?1:-1).slice(w*q,w*q+q),W=[{id:"name",label:"Meal Name",sortable:!0},{id:"items",label:"Items Required",sortable:!1,format:(t,n)=>(0,s.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:null==n?void 0:n.items.map((t,n)=>{let i=e.items.find(e=>e.id===t.itemId);return(0,s.jsx)(d.A,{label:"".concat(null==i?void 0:i.name," (").concat(t.usagePerPerson," ").concat(null==i?void 0:i.unit,"/person)"),size:"small",variant:"outlined"},n)})})},{id:"actions",label:"Actions",sortable:!1,align:"center",format:(e,t)=>(0,s.jsxs)(o.A,{children:[(0,s.jsx)(c.A,{size:"small",onClick:()=>{b(t),p(!0)},children:(0,s.jsx)(i.A,{})}),(0,s.jsx)(c.A,{size:"small",onClick:()=>{var e;return e=t.id,void(window.confirm("Are you sure you want to delete this meal?")&&A(e))},children:(0,s.jsx)(a.A,{})})]})}];return(0,s.jsxs)(m.A,{spacing:3,children:[(0,s.jsxs)(o.A,{className:"flex justify-between items-center",children:[(0,s.jsx)(u.A,{variant:"h4",children:"Meal Recipes"}),(0,s.jsxs)(o.A,{children:[(0,s.jsx)(h.A,{variant:"outlined",onClick:()=>{let t=e.meals.map(t=>({Name:t.name,"Number of Ingredients":t.items.length,"Items Required":t.items.map(t=>{let n=e.items.find(e=>e.id===t.itemId);return"".concat(null==n?void 0:n.name," (").concat(t.usagePerPerson," ").concat(null==n?void 0:n.unit,"/person)")}).join(", ")}));(0,k.GF)(t,"meals-export")},sx:{mr:2},children:"Export CSV"}),(0,s.jsx)(h.A,{variant:"contained",startIcon:(0,s.jsx)(l.A,{}),onClick:()=>p(!0),children:"Add Meal"})]})]}),(0,s.jsx)(o.A,{children:(0,s.jsx)(x.A,{fullWidth:!0,label:"Search meals",value:f,onChange:e=>P(e.target.value),InputProps:{startAdornment:(0,s.jsx)(r.A,{sx:{mr:1,color:"text.secondary"}})}})}),(0,s.jsx)(S.X,{columns:W,data:L,page:w,rowsPerPage:q,totalRows:O.length,onPageChange:U,onRowsPerPageChange:_,orderBy:N,order:E,onSort:e=>{M(N===e&&"asc"===E?"desc":"asc"),R(e)}}),(0,s.jsx)(y.a,{open:g,onClose:()=>{p(!1),b(void 0)},title:v?"Edit Meal":"Add New Meal",actions:(0,s.jsxs)(o.A,{children:[(0,s.jsx)(h.A,{onClick:()=>p(!1),children:"Cancel"}),(0,s.jsxs)(h.A,{type:"submit",form:"meal-form",variant:"contained",children:[v?"Update":"Add"," Meal"]})]}),children:(0,s.jsx)(I,{meal:v,onSubmit:e=>{v?n({...v,...e}):t(e),p(!1),b(void 0)},onCancel:()=>p(!1)})})]})}},8894:(e,t,n)=>{"use strict";n.d(t,{X:()=>h});var s=n(5640);n(148);var i=n(1585),a=n(2254),l=n(9015),r=n(9366),o=n(8488),d=n(3245),c=n(3671),m=n(8932),u=n(5504);let h=e=>{let{columns:t,data:n,page:h,rowsPerPage:x,totalRows:j,onPageChange:A,onRowsPerPageChange:g,orderBy:p,order:v,onSort:b}=e;return(0,s.jsxs)(i.A,{children:[(0,s.jsx)(a.A,{children:(0,s.jsxs)(l.A,{children:[(0,s.jsx)(r.A,{children:(0,s.jsx)(o.A,{children:t.map(e=>{let t;return(0,s.jsx)(d.A,{align:e.align||"left",sortDirection:p===e.id&&v,children:e.sortable&&b?(0,s.jsx)(c.A,{active:p===e.id,direction:p===e.id?v:"asc",onClick:(t=String(e.id),()=>{null==b||b(t)}),children:e.label}):e.label},String(e.id))})})}),(0,s.jsx)(m.A,{children:n.map((e,n)=>(0,s.jsx)(o.A,{children:t.map(t=>{let n=e[t.id];return(0,s.jsx)(d.A,{align:t.align||"left",children:t.format?t.format(n,e):String(null!=n?n:"")},String(t.id))})},n))})]})}),(0,s.jsx)(u.A,{rowsPerPageOptions:[5,10,25],component:"div",count:j,rowsPerPage:x,page:h,onPageChange:(e,t)=>{A(t)},onRowsPerPageChange:e=>{g(parseInt(e.target.value,10))}})]})}}},e=>{e.O(0,[447,269,130,892,19,636,593,792],()=>e(e.s=2176)),_N_E=e.O()}]);